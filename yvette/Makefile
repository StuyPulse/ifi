#This is automatically generated by the configure.py script
#Keep your dirty hands off
#Run ./configure.py to generate a fresh one.
MCC18=mcc18
PIC=18F8520
LIBNAME=FRC_library_8520.lib
ARGS=-D_FRC_BOARD -w3 pa=3
LINKER=mplink
MP2HEX=mp2hex
IFILOAD=picloader
SERIAL_DEV=/dev/ttyS0
READLOG=./read.log
LIB_PATH=/opt/mcc18/lib
CODE_PATH=Z:\home\prog\code\yvette\\
INCLUDE_PATH=/opt/mcc18/h
INCLUDE_PATHW=Z:\\opt\\mcc18\\h




ALL_TARGETS=user_routines.o trajectory.o main.o controller.o interrupts.o user_routines_fast.o traj_turn_radius.o traj_straight.o terminal.o traj_null.o velocity.o tracking.o serial_ports.o ifi_utilities.o ifi_startup.o gyro.o camera.o adc.o 
INCLUDE_FILES=trajectory.h user_routines.h controller.h camera.h traj_straight.h velocity.h traj_turn_radius.h traj_null.h tracking.h terminal.h serial_ports.h interrupts.h ifi_utilities.h ifi_default.h ifi_aliases.h gyro.h delays.h common_def.h adc.h 
############ Targets: 
default: FrcCode.hex

#Remove all the individual file backup (The files ending with ~)
#NOTE that this does NOT remove your tbz2 backups!
clean-backup-files:
	@echo -e "Removing all the ~ backup files your annoying editor makes..."
	@find . -name "*~" |xargs rm -f

#Removes all compiled files from the directory
clean: clean-backup-files clean-deps nohex
	@echo -e "Cleaning compiler intermediate files..."
	@rm -rf *.o *.err

#Remove deps folder
clean-deps:
	@echo -e "Cleaning dependency folder..."
	@rm -rf .deps
	@mkdir .deps
	@touch .deps/dummy

#Remove hexfiles
nohex:
	@echo -e "Cleaning linker output and hex files..."
	@rm -rf *.hex *.cod *.cof

#These all start the IFI Loader.
safeload: prettycode clean check load
load: FrcCode.hex
	$(IFILOAD) FrcCode.hex $(SERIAL_DEV)

read:
	@echo -e "Monitoring $(SERIAL_DEV) for data"
	@echo -e "Output will also be logged to $(READLOG)"
	@echo -e "---------"
	@picreader $(SERIAL_DEV) | tee $(READLOG) || /bin/true
	
	
prettycode:
	@echo -e "Using indent to autoformat your .c and .h files..."
	@indent *.c *.h
all: clean FrcCode.hex
%.o: %.c
	@echo -e "Compiling $@..."
	@echo -e "1.   Checking Dependencies for $@"
	@cpp -nostdinc -isystem $(INCLUDE_PATH) -D__$(PIC) -M -MP $< -MF .deps/$*.deps
	@echo -e "2.   Launching Compiler..."
	@echo -n "A thought to keep you occupied:  "
	@fortune -s || echo "GET FORTUNE"
	@$(MCC18) -p=$(PIC) -fo $@ $< /i\""$(INCLUDE_PATHW)"\" $(ARGS) 
	@echo -e "Done with $@."




FrcCode.hex :  $(ALL_TARGETS) $(INCLUDE_FILES)
	@echo -e "Linking..."
	$(LINKER) /l\""$(LIB_PATH)"\" \""`echo $(PIC) | tr F f `.lkr"\" $(ALL_TARGETS) \""$(CODE_PATH)$(LIBNAME)"\" /m\""FrcCode.map"\" /o\""FrcCode.cof"\"
	$(MP2HEX) FrcCode.cof
	@echo -e "Linked FrcCode.hex"



.deps/*: 
	@echo -e "Creating Dependency Makefiles..."
	@mkdir -p .deps
	@touch .deps/dummy
	@echo -e "Done!"

include .deps/*
